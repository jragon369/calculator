<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilo Protocol - Economic Calculator v13</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            padding: 2rem;
            min-height: 100vh;
        }

        .main-container {
            max-width: 1100px;
            margin: 0 auto;
        }

        .calculator-section {
            background: #111111;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid #222;
            margin-bottom: 1.5rem;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: normal;
            margin-bottom: 0.4rem;
            margin-top: 1.5rem;
            color: #ffffff;
            text-align: center;
        }

        h2.first-section {
            margin-top: 0.8rem;
        }

        .grid {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .inputs-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .outputs-section {
            background: #1a1a1a;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid #333;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .input-group {
            background: #1a1a1a;
            padding: 0.8rem;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
            max-width: 400px;
            margin: 0 auto;
        }

        label {
            display: block;
            margin-bottom: 0.3rem;
            color: #ccc;
            font-size: 0.85rem;
        }

        .input-wrapper {
            position: relative;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            margin: 0.5rem 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #8B0000;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #A52A2A;
        }

        .input-value {
            font-size: 0.95rem;
            font-weight: bold;
            color: #8B0000;
            margin-top: 0.3rem;
        }

        .time-selector {
            display: flex;
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .time-btn {
            flex: 1;
            padding: 0.6rem;
            background: #222;
            border: 1px solid #444;
            color: #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .time-btn:hover {
            background: #333;
            border-color: #8B0000;
        }

        .time-btn.active {
            background: #8B0000;
            color: #fff;
            font-weight: bold;
            border-color: #8B0000;
        }

        .output-item {
            text-align: center;
            border-right: 1px solid #333;
            padding: 0 0.8rem;
        }

        .output-item:last-child {
            border-right: none;
        }

        .output-label {
            color: #888;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .output-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 0.2rem;
        }

        .assumptions-section {
            background: #1a1a1a;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #333;
            margin-top: 1.5rem;
        }

        .assumptions-section h3 {
            color: #8B0000;
            font-size: 0.95rem;
            margin-bottom: 0.8rem;
            text-align: center;
        }

        .assumptions-section ul {
            list-style: none;
            padding: 0;
            columns: 2;
            column-gap: 2rem;
        }

        .assumptions-section li {
            color: #aaa;
            font-size: 0.65rem;
            margin-bottom: 0.3rem;
            break-inside: avoid;
        }

        @media (max-width: 768px) {
            .calculator-section {
                padding: 1.5rem;
            }

            .inputs-section {
                grid-template-columns: 1fr;
            }

            .outputs-section {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .output-item {
                border-right: none;
                border-bottom: 1px solid #333;
                padding: 1rem 0;
            }

            .output-item:last-child {
                border-bottom: none;
            }

            .assumptions-section ul {
                columns: 1;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="calculator-section">
            <div class="grid">
                <div class="inputs-section">
                    <div class="input-group">
                        <label for="btcCAGR">BTC CAGR</label>
                        <div class="input-wrapper">
                            <input type="range" id="btcCAGR" min="0" max="100" value="60" step="5">
                            <div class="input-value" id="btcValue">60%</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="athletesPerMonth">NEW ATHLETES PER MONTH</label>
                        <div class="input-wrapper">
                            <input type="range" id="athletesPerMonth" min="1000" max="9000" value="1000" step="1000">
                            <div class="input-value" id="athletesValue">1,000</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="collectivesPerMonth">NEW COLLECTIVES PER MONTH</label>
                        <div class="input-wrapper">
                            <input type="range" id="collectivesPerMonth" min="1" max="9" value="1" step="1">
                            <div class="input-value" id="collectivesValue">1</div>
                        </div>
                    </div>
                </div>

                <div class="input-group full-width">
                    <label for="timeframe">HORIZON (YEARS)</label>
                    <div class="time-selector">
                        <button class="time-btn active" onclick="setTimeframe(1, this)">1</button>
                        <button class="time-btn" onclick="setTimeframe(3, this)">3</button>
                        <button class="time-btn" onclick="setTimeframe(6, this)">6</button>
                        <button class="time-btn" onclick="setTimeframe(9, this)">9</button>
                    </div>
                </div>

                <h2 class="first-section">AVATAR</h2>
                <div class="outputs-section">
                    <div class="output-item">
                        <div class="output-label">KILO Per Win</div>
                        <div class="output-value" id="kiloOutput">50</div>
                    </div>

                    <div class="output-item">
                        <div class="output-label">Avatar Value</div>
                        <div class="output-value" id="avatarValue">$1.5K</div>
                    </div>
                </div>

                <h2>COLLECTIVE</h2>
                <div class="outputs-section">
                    <div class="output-item">
                        <div class="output-label">Treasury (BTC)</div>
                        <div class="output-value" id="treasuryOutput">120 BTC</div>
                    </div>

                    <div class="output-item">
                        <div class="output-label">Annual Revenue</div>
                        <div class="output-value" id="collectiveRevenueOutput">$750K</div>
                    </div>
                </div>

                <h2>NETWORK</h2>
                <div class="outputs-section">
                    <div class="output-item">
                        <div class="output-label">Treasury (BTC)</div>
                        <div class="output-value" id="networkTreasuryOutput">150 BTC</div>
                    </div>

                    <div class="output-item">
                        <div class="output-label">Annual Revenue</div>
                        <div class="output-value" id="networkRevenue">$4.3M</div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script>
        // Global state
        let currentBTC = 60;
        let athletesPerMonth = 1000;
        let collectivesPerMonth = 1;
        let timeframe = 1;

        // Format currency
        function formatCurrency(value) {
            if (value >= 1000000000) {
                return '$' + Math.round(value / 1000000000) + 'B';
            } else if (value >= 1000000) {
                return '$' + (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return '$' + Math.round(value / 1000) + 'K';
            } else {
                return '$' + Math.round(value).toLocaleString();
            }
        }

        // Format BTC
        function formatBTC(btc) {
            if (btc >= 1000) {
                return btc.toLocaleString('en-US', {maximumFractionDigits: 0}) + ' BTC';
            } else {
                return btc.toFixed(0) + ' BTC';
            }
        }

        // Calculate athlete earnings with network effects and growth velocity
        function calculateAthleteEarnings(totalAthletes, totalCollectives, timeInMonths) {
            const baseEarnings = 750; // Base $750/year
            
            // Use the global variables directly for growth rates
            const monthlyAthleteGrowth = athletesPerMonth;
            const monthlyCollectiveGrowth = collectivesPerMonth;
            
            // Factor 1: Network size effect (more athletes = more opportunities)
            const athleteEffect = Math.pow(Math.max(totalAthletes / 1000, 1), 0.4);
            
            // Factor 2: Collective growth effect (more collectives = more competition/prizes)
            const collectiveEffect = Math.pow(Math.max(totalCollectives / 10, 1), 0.5);
            
            // Factor 3: Time maturity effect (network matures over time)
            const timeEffect = Math.pow(Math.max(timeInMonths / 12, 1), 0.5); // Increased from 0.3 to 0.5 for extended growth
            
            // Factor 4: Growth velocity effect - THIS IS THE KEY
            // Velocity multiplier: faster growth = higher value
            const athleteVelocity = Math.pow(Math.max(monthlyAthleteGrowth / 1000, 1), 0.35);
            const collectiveVelocity = Math.pow(Math.max(monthlyCollectiveGrowth, 1), 0.4);
            
            // Combined multiplier includes velocity
            const combinedMultiplier = athleteEffect * collectiveEffect * timeEffect * athleteVelocity * collectiveVelocity;
            
            return baseEarnings * Math.min(combinedMultiplier, 1000); // Cap at 1000x for stability
        }

        // Update display values
        document.getElementById('btcCAGR').addEventListener('input', function() {
            currentBTC = parseInt(this.value);
            document.getElementById('btcValue').textContent = currentBTC + '%';
            calculateAllMetrics();
        });

        document.getElementById('athletesPerMonth').addEventListener('input', function() {
            athletesPerMonth = parseInt(this.value);
            document.getElementById('athletesValue').textContent = athletesPerMonth.toLocaleString();
            calculateAllMetrics();
        });

        document.getElementById('collectivesPerMonth').addEventListener('input', function() {
            collectivesPerMonth = parseInt(this.value);
            document.getElementById('collectivesValue').textContent = collectivesPerMonth;
            calculateAllMetrics();
        });

        function setTimeframe(years, element) {
            timeframe = years;
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            calculateAllMetrics();
        }

        // Main calculation function - using sophisticated month-by-month simulation
        function calculateAllMetrics() {
            // Model Parameters
            const params = {
                btcCAGR: currentBTC / 100,
                years: timeframe,
                months: timeframe * 12,
                initialBTCPrice: 100000,
                networkTreasuryStartBTC: 100,
                avatarsPerCollective: 1000,
                collectiveAvatarShare: 0.88,
                networkAvatarShare: 0.12,
                monthlySubscriptionFee: 9,
                collectiveRevenueShare: 0.09, // 9% of athlete revenues goes to collective
                networkRevenueShare: 0.03, // 3% of athlete revenues goes to network
                dailyWinRate: 0.001, // 0.1% of athletes win daily
                competitionTokensPerMonth: 9,
                conversionRate: 0.15, // 15% annually (vibrant utility ecosystem)
                conversionBurnRate: 0.97, // 97% burned, 3% to network
                revenueToRewards: 0.60, // 60% to rewards pool
                revenueToTreasury: 0.30, // 30% to BTC treasury
                revenueToOperations: 0.10, // 10% to operations
                kiloToSatoshi: 1000,
                satoshiPerBTC: 100000000,
                circulatingFloor: 0.10
            };

            // Initialize state tracking
            const state = {
                collectives: [],
                networkTreasuryBTC: params.networkTreasuryStartBTC,
                totalKiloSupply: 0,
                totalKiloBurned: 0,
                monthlyData: []
            };

            // Main simulation loop - month by month
            for (let month = 1; month <= params.months; month++) {
                // Calculate BTC prices for this month
                const btcPriceStart = params.initialBTCPrice * Math.pow(1 + params.btcCAGR, (month - 1) / 12);
                const btcPriceEnd = params.initialBTCPrice * Math.pow(1 + params.btcCAGR, month / 12);
                const btcPriceAvg = (btcPriceStart + btcPriceEnd) / 2;

                // Update all collectives - add new athletes first
                let totalActiveAthletes = 0;
                state.collectives.forEach(collective => {
                    if (month >= collective.launchMonth) {
                        // Add new athletes this month
                        collective.athletes = Math.min(collective.athletes + athletesPerMonth, params.avatarsPerCollective);
                    }
                    totalActiveAthletes += collective.athletes;
                });

                // Calculate current athlete earnings based on network size and growth velocity
                const currentAthleteEarnings = calculateAthleteEarnings(
                    totalActiveAthletes, 
                    state.collectives.length,
                    month
                );
                const currentAvatarValue = currentAthleteEarnings * 2; // Avatar = 2x annual earnings

                // Launch new collectives this month
                for (let i = 0; i < collectivesPerMonth; i++) {
                    const avatarSalesRevenue = currentAvatarValue * params.avatarsPerCollective;
                    
                    const newCollective = {
                        id: state.collectives.length + 1,
                        launchMonth: month,
                        athletes: 0,
                        avatarValue: currentAvatarValue,
                        treasuryBTC: (avatarSalesRevenue * params.collectiveAvatarShare) / btcPriceAvg
                    };
                    state.collectives.push(newCollective);

                    // Network receives avatar sale fees (12%)
                    state.networkTreasuryBTC += (avatarSalesRevenue * params.networkAvatarShare) / btcPriceAvg;
                }

                // Calculate network revenue for this month
                const monthlyNetworkRevenue = calculateMonthlyNetworkRevenue(
                    totalActiveAthletes,
                    currentAthleteEarnings,
                    state.collectives,
                    btcPriceAvg,
                    params
                );

                // Process network revenue allocation
                const rewardsPoolContribution = monthlyNetworkRevenue.total * params.revenueToRewards;
                const treasuryAdditionUSD = monthlyNetworkRevenue.total * params.revenueToTreasury;
                const operationsUSD = monthlyNetworkRevenue.total * params.revenueToOperations;
                const treasuryAdditionBTC = treasuryAdditionUSD / btcPriceAvg;

                // Calculate monthly KILO rewards distributed (from rewards pool)
                const monthlyKiloDistributed = (rewardsPoolContribution / btcPriceAvg) * params.satoshiPerBTC / params.kiloToSatoshi;
                
                // Process conversions from NETWORK treasury (not collective)
                // 15% of distributed KILO gets converted annually
                const monthlyConversionRate = params.conversionRate / 12;
                const kiloConvertedThisMonth = state.totalKiloSupply * monthlyConversionRate;
                const btcPaidOut = (kiloConvertedThisMonth * params.kiloToSatoshi / params.satoshiPerBTC);
                
                // Network treasury pays out BTC for conversions
                state.networkTreasuryBTC -= btcPaidOut;
                
                // 97% of converted KILO gets burned
                const kiloBurnedFromConversions = kiloConvertedThisMonth * params.conversionBurnRate;
                
                // Update network treasury (30% of revenue + BTC from avatar sales - conversion payouts)
                state.networkTreasuryBTC += treasuryAdditionBTC;
                
                // Ensure network treasury doesn't go negative
                if (state.networkTreasuryBTC < 0) {
                    state.networkTreasuryBTC = 0;
                }

                // Track KILO supply (only liquid KILO from rewards, not utility kilo)
                state.totalKiloSupply += monthlyKiloDistributed;
                state.totalKiloBurned += kiloBurnedFromConversions;

                // Store monthly data
                state.monthlyData[month] = {
                    btcPrice: btcPriceEnd,
                    totalCollectives: state.collectives.length,
                    totalAthletes: totalActiveAthletes,
                    networkRevenue: monthlyNetworkRevenue.total,
                    rewardsContribution: rewardsPoolContribution,
                    dailyWinners: totalActiveAthletes * params.dailyWinRate,
                    currentAvatarValue: currentAvatarValue,
                    currentAthleteEarnings: currentAthleteEarnings
                };
            }

            // Calculate final outputs
            const outputs = calculateFinalOutputs(state, params);

            // Update UI
            updateDisplay(outputs);
        }

        // Calculate monthly network revenue from all sources
        function calculateMonthlyNetworkRevenue(totalAthletes, athleteEarnings, collectives, btcPrice, params) {
            // Primary revenue: $9/month subscription from all athletes
            const subscriptionRevenue = totalAthletes * params.monthlySubscriptionFee;

            // NEW: Network also gets 3% of athlete content revenues
            const athleteContentRevenue = (totalAthletes * athleteEarnings * params.networkRevenueShare) / 12; // Convert annual to monthly

            return {
                total: subscriptionRevenue + athleteContentRevenue,
                subscription: subscriptionRevenue,
                revenueShare: athleteContentRevenue
            };
        }

        // Calculate final outputs for display
        function calculateFinalOutputs(state, params) {
            const finalMonth = state.monthlyData[params.months];
            const finalBTCPrice = finalMonth.btcPrice;

            // Representative collective (oldest)
            const oldestCollective = state.collectives[0] || { 
                athletes: 0, 
                treasuryBTC: 0, 
                avatarValue: 1500 
            };
            
            // Collective treasury in BTC (after conversions)
            const collectiveTreasuryBTC = oldestCollective.treasuryBTC;

            // Collective annual revenue (9% of athlete revenues)
            const collectiveAthletes = oldestCollective.athletes;
            const athleteRevenue = collectiveAthletes * finalMonth.currentAthleteEarnings;
            const collectiveAnnualRevenue = athleteRevenue * params.collectiveRevenueShare;

            // Calculate KILO per win based on rewards pool
            const finalMonthRewardsPool = finalMonth.rewardsContribution;
            const annualizedRewardsPool = finalMonthRewardsPool * 12;
            const dailyRewardsPoolUSD = annualizedRewardsPool / 365;
            const dailyRewardsPoolBTC = dailyRewardsPoolUSD / finalBTCPrice;
            const dailyRewardsPoolSatoshi = dailyRewardsPoolBTC * params.satoshiPerBTC;
            const finalDailyWinners = finalMonth.dailyWinners;
            const kiloPerWin = finalDailyWinners > 0 ? 
                Math.floor(dailyRewardsPoolSatoshi / finalDailyWinners / params.kiloToSatoshi) : 0;

            // Latest avatar value
            const latestAvatarValue = finalMonth.currentAvatarValue;

            // Network metrics
            const networkTreasuryUSD = state.networkTreasuryBTC * finalBTCPrice;
            const annualNetworkRevenue = finalMonth.networkRevenue * 12;

            return {
                collectiveTreasuryBTC: collectiveTreasuryBTC,
                collectiveAnnualRevenue: collectiveAnnualRevenue,
                kiloPerWin: kiloPerWin,
                avatarValue: latestAvatarValue,
                networkTreasuryBTC: state.networkTreasuryBTC,
                networkTreasuryUSD: networkTreasuryUSD,
                annualNetworkRevenue: annualNetworkRevenue
            };
        }

        // Update the display
        function updateDisplay(outputs) {
            document.getElementById('treasuryOutput').textContent = formatBTC(outputs.collectiveTreasuryBTC);
            document.getElementById('collectiveRevenueOutput').textContent = formatCurrency(outputs.collectiveAnnualRevenue);
            document.getElementById('kiloOutput').textContent = outputs.kiloPerWin.toLocaleString('en-US');
            document.getElementById('avatarValue').textContent = formatCurrency(outputs.avatarValue);
            document.getElementById('networkTreasuryOutput').textContent = formatBTC(outputs.networkTreasuryBTC);
            document.getElementById('networkRevenue').textContent = formatCurrency(outputs.annualNetworkRevenue);
        }

        // Initial calculation
        calculateAllMetrics();
    </script>
</body>
</html>
