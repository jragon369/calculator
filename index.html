<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilo Protocol - Economic Calculator v8</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            padding: 2rem;
            min-height: 100vh;
        }
       
        .main-container {
            max-width: 1100px;
            margin: 0 auto;
        }
       
        .calculator-section {
            background: #111111;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid #222;
            margin-bottom: 2rem;
        }
       
        h1 {
            font-size: 2.5rem;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #f7931a 0%, #ffb84d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }
       
        h2 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: #f7931a;
            text-align: center;
        }
       
        .grid {
            display: flex;
            flex-direction: column;
            gap: 3rem;
        }
       
        .inputs-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
       
        .outputs-section {
            background: #1a1a1a;
            padding: 2.5rem;
            border-radius: 12px;
            border: 1px solid #333;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }
       
        .input-group {
            background: #1a1a1a;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #333;
        }
       
        .input-group.full-width {
            grid-column: 1 / -1;
            max-width: 400px;
            margin: 0 auto;
        }
       
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ccc;
            font-size: 0.9rem;
        }
       
        .input-wrapper {
            position: relative;
        }
       
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            margin: 1rem 0;
        }
       
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #f7931a;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
       
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #ffb84d;
        }
       
        .input-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #f7931a;
            margin-top: 0.5rem;
        }
       
        .time-selector {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
       
        .time-btn {
            flex: 1;
            padding: 0.8rem;
            background: #222;
            border: 1px solid #444;
            color: #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
       
        .time-btn:hover {
            background: #333;
            border-color: #f7931a;
        }
       
        .time-btn.active {
            background: #f7931a;
            color: #000;
            font-weight: bold;
            border-color: #f7931a;
        }
       
        .output-item {
            text-align: center;
            border-right: 1px solid #333;
            padding: 0 2rem;
        }
       
        .output-item:last-child {
            border-right: none;
        }
       
        .output-label {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
       
        .output-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 0.3rem;
        }
       
        .assumptions-section {
            background: #1a1a1a;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #333;
            margin-top: 2rem;
        }
       
        .assumptions-section h3 {
            color: #f7931a;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            text-align: center;
        }
       
        .assumptions-section ul {
            list-style: none;
            padding: 0;
            columns: 2;
            column-gap: 2rem;
        }
       
        .assumptions-section li {
            color: #aaa;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            break-inside: avoid;
        }
       
        @media (max-width: 768px) {
            .inputs-section {
                grid-template-columns: 1fr;
            }
           
            .outputs-section {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
           
            .output-item {
                border-right: none;
                border-bottom: 1px solid #333;
                padding: 1.5rem 0;
            }
           
            .output-item:last-child {
                border-bottom: none;
            }
           
            .calculator-section {
                padding: 2rem;
            }
           
            h1 {
                font-size: 2rem;
            }
           
            .assumptions-section ul {
                columns: 1;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="calculator-section">
            <h1>KILO PROTOCOL</h1>
           
            <div class="grid">
                <div class="inputs-section">
                    <div class="input-group">
                        <label for="btcCAGR">BTC CAGR</label>
                        <div class="input-wrapper">
                            <input type="range" id="btcCAGR" min="0" max="100" value="60" step="5">
                            <div class="input-value" id="btcValue">60%</div>
                        </div>
                    </div>
                   
                    <div class="input-group">
                        <label for="athletesPerMonth">NEW ATHLETES PER MONTH</label>
                        <div class="input-wrapper">
                            <input type="range" id="athletesPerMonth" min="1000" max="20000" value="5000" step="1000">
                            <div class="input-value" id="athletesValue">5,000</div>
                        </div>
                    </div>
                   
                    <div class="input-group">
                        <label for="collectivesPerMonth">NEW COLLECTIVES PER MONTH</label>
                        <div class="input-wrapper">
                            <input type="range" id="collectivesPerMonth" min="1" max="10" value="2" step="1">
                            <div class="input-value" id="collectivesValue">2</div>
                        </div>
                    </div>
                </div>
               
                <h2>COLLECTIVE METRICS</h2>
                <div class="outputs-section">
                    <div class="output-item">
                        <div class="output-label">Collective Treasury</div>
                        <div class="output-value" id="treasuryOutput">$12M</div>
                    </div>
                   
                    <div class="output-item">
                        <div class="output-label">Collective Annual Revenue</div>
                        <div class="output-value" id="collectiveRevenueOutput">$750K</div>
                    </div>
                   
                    <div class="output-item">
                        <div class="output-label">Kilo Per Win</div>
                        <div class="output-value" id="kiloOutput">50</div>
                    </div>
                </div>
               
                <h2>NETWORK METRICS</h2>
                <div class="outputs-section">
                    <div class="output-item">
                        <div class="output-label">Network Treasury</div>
                        <div class="output-value" id="networkTreasuryOutput">150 BTC</div>
                    </div>
                   
                    <div class="output-item">
                        <div class="output-label">Staking Yield</div>
                        <div class="output-value" id="stakingYield">12%</div>
                    </div>
                   
                    <div class="output-item">
                        <div class="output-label">Network Annual Revenue</div>
                        <div class="output-value" id="networkRevenue">$4.3M</div>
                    </div>
                </div>
               
                <div class="input-group full-width">
                    <label for="timeframe">HORIZON (YEARS)</label>
                    <div class="time-selector">
                        <button class="time-btn active" onclick="setTimeframe(1, this)">1</button>
                        <button class="time-btn" onclick="setTimeframe(3, this)">3</button>
                        <button class="time-btn" onclick="setTimeframe(6, this)">6</button>
                        <button class="time-btn" onclick="setTimeframe(9, this)">9</button>
                    </div>
                </div>
            </div>
           
            <div class="assumptions-section">
                <h3>Key Model Assumptions</h3>
                <ul>
                    <li>Initial BTC Price: $100,000</li>
                    <li>Network Treasury Start: 100 BTC</li>
                    <li>Avatars per Collective: 1,000 (capped)</li>
                    <li>Avatar Price: $3,000 (fixed)</li>
                    <li>Avatar Sales Revenue: $3,000,000</li>
                    <li>Collective Share of Avatar Sales: 88%</li>
                    <li>Network Avatar Fee: 12%</li>
                    <li>Monthly Subscription: $9/athlete</li>
                    <li>Athlete Content Revenue: $1,000/year average</li>
                    <li>Collective Revenue Share: 15% of athlete content</li>
                    <li>Network Content Fee: 10%</li>
                    <li>Clone Revenue: $1,000/avatar/year</li>
                    <li>Network Clone Fee: 12%</li>
                    <li>Post Rate: 15% of athletes compete daily</li>
                    <li>Win Rate: 1% of posts win</li>
                    <li>Competition Tokens: 9 KILO/month/athlete (including on joining)</li>
                    <li>Conversion Rate: 30% annually</li>
                    <li>Conversion Burn: 97% (3% network fee)</li>
                    <li>Resale Rate: 10% annually</li>
                    <li>Resale Fee: 3% to network</li>
                    <li>Revenue to Prizes: 60%</li>
                    <li>Appreciation to Prizes: 30%</li>
                    <li>Revenue to Staking: 30%</li>
                    <li>Staking Participation: 30%</li>
                    <li>Staking Yield Cap: 21%</li>
                    <li>KILO to Satoshi: 1 KILO = 1,000 satoshi</li>
                    <li>Satoshi per BTC: 100,000,000</li>
                    <li>Circulating Supply Floor: 10% of total minted</li>
                </ul>
                <p style="color: #666; font-size: 0.85rem; margin-top: 1rem;">
                    Note: This model excludes token speculation, betting markets, AI data licensing,
                    premium subscriptions, physical venues, and other potential revenue streams.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentBTC = 60;
        let athletesPerMonth = 5000;
        let collectivesPerMonth = 2;
        let timeframe = 1;
       
        // Format currency
        function formatCurrency(value) {
            if (value >= 1000000000) {
                return '$' + Math.round(value / 1000000000) + 'B';
            } else if (value >= 1000000) {
                return '$' + (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return '$' + Math.round(value / 1000) + 'K';
            } else {
                return '$' + Math.round(value).toLocaleString();
            }
        }
       
        // Format BTC
        function formatBTC(btc) {
            if (btc >= 1000) {
                return Math.round(btc).toLocaleString() + ' BTC';
            } else {
                return btc.toFixed(0) + ' BTC';
            }
        }
       
        // Update display values
        document.getElementById('btcCAGR').addEventListener('input', function() {
            currentBTC = parseInt(this.value);
            document.getElementById('btcValue').textContent = currentBTC + '%';
            calculateAllMetrics();
        });
       
        document.getElementById('athletesPerMonth').addEventListener('input', function() {
            athletesPerMonth = parseInt(this.value);
            document.getElementById('athletesValue').textContent = athletesPerMonth.toLocaleString();
            calculateAllMetrics();
        });
       
        document.getElementById('collectivesPerMonth').addEventListener('input', function() {
            collectivesPerMonth = parseInt(this.value);
            document.getElementById('collectivesValue').textContent = collectivesPerMonth;
            calculateAllMetrics();
        });
       
        function setTimeframe(years, element) {
            timeframe = years;
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            calculateAllMetrics();
        }
       
        // Main calculation function - complete rewrite for accuracy
        function calculateAllMetrics() {
            // Model Parameters (all in one place for transparency)
            const params = {
                btcCAGR: currentBTC / 100,
                years: timeframe,
                months: timeframe * 12,
                initialBTCPrice: 100000,
                networkTreasuryStartBTC: 100,
                avatarsPerCollective: 1000,
                avatarPrice: 3000,
                avatarSalesRevenue: 3000000,
                networkAvatarCut: 0.12,
                monthlySubscriptionFee: 9,
                athleteContentRevenue: 1000,
                collectiveContentShare: 0.15,
                networkContentShare: 0.10,
                cloneRevenuePerAvatar: 1000,
                networkCloneShare: 0.12,
                conversionRate: 0.30,
                conversionFeeRate: 0.03,
                resaleRate: 0.10,
                resaleFeeRate: 0.03,
                postRate: 0.15,
                winRate: 0.01,
                competitionTokensPerMonth: 9,
                initialKiloPerAthlete: 30,
                revenueToPrizes: 0.60,
                appreciationToPrizes: 0.30,
                revenueToStaking: 0.30,
                stakingParticipation: 0.30,
                stakingYieldCap: 0.21,
                kiloToSatoshi: 1000,
                satoshiPerBTC: 100000000,
                circulatingFloor: 0.10
            };
           
            // Initialize state tracking
            const state = {
                collectives: [],
                networkTreasuryBTC: params.networkTreasuryStartBTC,
                totalKiloSupply: 0,
                totalKiloBurned: 0,
                monthlyData: []
            };
           
            // Main simulation loop - month by month
            for (let month = 1; month <= params.months; month++) {
                // Calculate BTC prices for this month
                const btcPriceStart = params.initialBTCPrice * Math.pow(1 + params.btcCAGR, (month - 1) / 12);
                const btcPriceEnd = params.initialBTCPrice * Math.pow(1 + params.btcCAGR, month / 12);
                const btcPriceAvg = (btcPriceStart + btcPriceEnd) / 2;
               
                // Launch new collectives this month
                for (let i = 0; i < collectivesPerMonth; i++) {
                    const newCollective = {
                        id: state.collectives.length + 1,
                        launchMonth: month,
                        athletes: 0,
                        treasuryBTC: (params.avatarSalesRevenue * (1 - params.networkAvatarCut)) / btcPriceAvg
                    };
                    state.collectives.push(newCollective);
                   
                    // Network receives avatar sale fees
                    state.networkTreasuryBTC += (params.avatarSalesRevenue * params.networkAvatarCut) / btcPriceAvg;
                }
               
                // Update all collectives - add new athletes
                let monthlyNewAthletes = 0;
                let totalActiveAthletes = 0;
               
                state.collectives.forEach(collective => {
                    if (month >= collective.launchMonth) {
                        // Add new athletes this month
                        collective.athletes += athletesPerMonth;
                        monthlyNewAthletes += athletesPerMonth;
                    }
                    totalActiveAthletes += collective.athletes;
                });
               
                // Calculate network revenue for this month
                const monthlyNetworkRevenue = calculateMonthlyNetworkRevenue(
                    state.collectives,
                    totalActiveAthletes,
                    btcPriceAvg,
                    params
                );
               
                // Network treasury appreciation and prize distribution
                const treasuryGrowth = calculateNetworkTreasuryGrowth(
                    state.networkTreasuryBTC,
                    btcPriceStart,
                    btcPriceEnd,
                    monthlyNetworkRevenue,
                    params
                );
               
                // Update network treasury
                state.networkTreasuryBTC = treasuryGrowth.newTreasuryBTC;
               
                // KILO supply dynamics
                const kiloActivity = calculateKiloActivity(
                    monthlyNewAthletes,
                    totalActiveAthletes,
                    monthlyNetworkRevenue.totalConversions,
                    btcPriceAvg,
                    params
                );
               
                state.totalKiloSupply += kiloActivity.minted;
                state.totalKiloBurned += kiloActivity.burned;
               
                // Store monthly data
                state.monthlyData[month] = {
                    btcPrice: btcPriceEnd,
                    totalCollectives: state.collectives.length,
                    totalAthletes: totalActiveAthletes,
                    networkRevenue: monthlyNetworkRevenue.total,
                    prizeContribution: treasuryGrowth.prizeContribution,
                    dailyWinners: totalActiveAthletes * params.postRate * params.winRate
                };
            }
           
            // Calculate final outputs
            const outputs = calculateFinalOutputs(state, params);
           
            // Update UI
            updateDisplay(outputs);
        }
       
        // Calculate monthly network revenue from all sources
        function calculateMonthlyNetworkRevenue(collectives, totalAthletes, btcPrice, params) {
            // Subscription revenue (all athletes pay network)
            const subscriptionRevenue = totalAthletes * params.monthlySubscriptionFee;
           
            // Clone revenue share
            const totalAvatars = collectives.length * params.avatarsPerCollective;
            const cloneRevenue = (totalAvatars * params.cloneRevenuePerAvatar / 12) * params.networkCloneShare;
           
            // Athlete content economy share
            const athleteContentRevenue = (totalAthletes * params.athleteContentRevenue / 12) * params.networkContentShare;
           
            // Conversion fees (estimate based on collective treasuries)
            let totalCollectiveTreasuryBTC = 0;
            collectives.forEach(c => totalCollectiveTreasuryBTC += c.treasuryBTC);
            const totalCollectiveTreasuryUSD = totalCollectiveTreasuryBTC * btcPrice;
            const monthlyConversionVolume = (totalCollectiveTreasuryUSD * params.conversionRate) / 12;
            const conversionFeeRevenue = monthlyConversionVolume * params.conversionFeeRate;
           
            // Resale fees
            const avgAvatarValue = params.avatarPrice * (btcPrice / params.initialBTCPrice);
            const monthlyResaleVolume = (totalAvatars * avgAvatarValue * params.resaleRate) / 12;
            const resaleFeeRevenue = monthlyResaleVolume * params.resaleFeeRate;
           
            return {
                total: subscriptionRevenue + cloneRevenue + athleteContentRevenue + conversionFeeRevenue + resaleFeeRevenue,
                totalConversions: monthlyConversionVolume
            };
        }
       
        // Calculate network treasury growth and prize distribution
        function calculateNetworkTreasuryGrowth(treasuryBTC, btcPriceStart, btcPriceEnd, monthlyRevenue, params) {
            // Calculate appreciation on existing treasury
            const treasuryStartValue = treasuryBTC * btcPriceStart;
            const treasuryEndValue = treasuryBTC * btcPriceEnd;
            const appreciation = treasuryEndValue - treasuryStartValue;
           
            // Distribute appreciation to prizes
            const appreciationToPrizes = appreciation * params.appreciationToPrizes;
           
            // Add monthly revenue to treasury
            const revenueBTC = monthlyRevenue.total / btcPriceEnd;
           
            // Calculate revenue contribution to prizes
            const revenueToPrizes = monthlyRevenue.total * params.revenueToPrizes;
           
            // Deduct prize distributions from treasury
            const totalPrizesUSD = appreciationToPrizes + revenueToPrizes;
            const prizesBTC = totalPrizesUSD / btcPriceEnd;
            const newTreasuryBTC = treasuryBTC + revenueBTC - prizesBTC;
           
            return {
                newTreasuryBTC: newTreasuryBTC,
                prizeContribution: totalPrizesUSD
            };
        }
       
        // Calculate KILO minting and burning
        function calculateKiloActivity(newAthletes, totalAthletes, conversionVolume, btcPrice, params) {
            // Minting
            const newAthleteTokens = newAthletes * params.competitionTokensPerMonth; // New athletes get 9 KILO
            const monthlyCompetitionTokens = totalAthletes * params.competitionTokensPerMonth; // All athletes get 9 KILO monthly
            const totalMinted = newAthleteTokens + monthlyCompetitionTokens;
           
            // Burning
            const competitionBurns = totalAthletes * params.postRate * params.winRate * 30 * params.competitionTokensPerMonth;
            const conversionBurns = (conversionVolume / btcPrice * params.satoshiPerBTC / params.kiloToSatoshi) * 0.97;
            const totalBurned = competitionBurns + conversionBurns;
           
            return {
                minted: totalMinted,
                burned: totalBurned
            };
        }
       
        // Calculate final outputs for display
        function calculateFinalOutputs(state, params) {
            const finalMonth = state.monthlyData[params.months];
            const finalBTCPrice = finalMonth.btcPrice;
           
            // Representative collective (oldest)
            const oldestCollective = state.collectives[0] || { athletes: 0, treasuryBTC: 0 };
            const collectiveTreasuryUSD = oldestCollective.treasuryBTC * finalBTCPrice;
           
            // Collective annual revenue (from athlete content)
            const athleteRevenue = oldestCollective.athletes * params.athleteContentRevenue;
            const collectiveAnnualRevenue = athleteRevenue * params.collectiveContentShare;
           
            // Calculate total prize pool
            let totalPrizePool = 0;
            for (let i = 1; i <= params.months; i++) {
                totalPrizePool += state.monthlyData[i].prizeContribution;
            }
           
            // Calculate KILO per win using final month run rate for better accuracy
            const finalMonthData = state.monthlyData[params.months];
            const finalMonthPrizePool = finalMonthData.prizeContribution;
            const annualizedPrizePool = finalMonthPrizePool * 12;
            const dailyPrizePoolUSD = annualizedPrizePool / 365;
            const dailyPrizePoolBTC = dailyPrizePoolUSD / finalBTCPrice;
            const dailyPrizePoolSatoshi = dailyPrizePoolBTC * params.satoshiPerBTC;
            const finalDailyWinners = finalMonthData.dailyWinners;
            const kiloPerWin = finalDailyWinners > 0 ? Math.floor(dailyPrizePoolSatoshi / finalDailyWinners / params.kiloToSatoshi) : 0;
           
            // Network metrics
            const networkTreasuryUSD = state.networkTreasuryBTC * finalBTCPrice;
            const annualNetworkRevenue = finalMonth.networkRevenue * 12; // Run rate
           
            // Staking yield calculation using average BTC price
            const circulatingSupply = Math.max(
                state.totalKiloSupply - state.totalKiloBurned,
                state.totalKiloSupply * params.circulatingFloor
            );
            const stakedKilo = circulatingSupply * params.stakingParticipation;
            const annualStakingRewards = annualNetworkRevenue * params.revenueToStaking;
           
            // Calculate average BTC price over period
            let totalBTCPrice = 0;
            for (let i = 1; i <= params.months; i++) {
                totalBTCPrice += state.monthlyData[i].btcPrice;
            }
            const avgBTCPrice = totalBTCPrice / params.months;
           
            const stakedKiloValueUSD = (stakedKilo * params.kiloToSatoshi / params.satoshiPerBTC) * avgBTCPrice;
            const stakingYield = stakedKiloValueUSD > 0 ? (annualStakingRewards / stakedKiloValueUSD) : 0.10;
            const cappedStakingYield = Math.min(params.stakingYieldCap, Math.max(0.05, stakingYield));
           
            return {
                collectiveTreasuryUSD: collectiveTreasuryUSD,
                collectiveAnnualRevenue: collectiveAnnualRevenue,
                kiloPerWin: kiloPerWin,
                networkTreasuryBTC: state.networkTreasuryBTC,
                networkTreasuryUSD: networkTreasuryUSD,
                stakingYield: cappedStakingYield,
                annualNetworkRevenue: annualNetworkRevenue
            };
        }
       
        // Update the display
        function updateDisplay(outputs) {
            document.getElementById('treasuryOutput').textContent = formatCurrency(outputs.collectiveTreasuryUSD);
            document.getElementById('collectiveRevenueOutput').textContent = formatCurrency(outputs.collectiveAnnualRevenue);
            document.getElementById('kiloOutput').textContent = outputs.kiloPerWin.toLocaleString();
            document.getElementById('networkTreasuryOutput').textContent = formatBTC(outputs.networkTreasuryBTC);
            document.getElementById('stakingYield').textContent = (outputs.stakingYield * 100).toFixed(1) + '%';
            document.getElementById('networkRevenue').textContent = formatCurrency(outputs.annualNetworkRevenue);
        }
       
        // Initial calculation
        calculateAllMetrics();
    </script>
</body>
</html>
